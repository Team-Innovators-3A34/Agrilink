{% extends 'base.html.twig' %}

{% block title %}
    Event List
{% endblock %}

{% block body %}
<div class="container mt-5">
    <h2 class="mb-4 text-center">List of Events</h2>

    <div class="text-end mb-3">
        <a href="{{ path('add_event') }}" class="btn btn-success">Add New Event</a>
    </div>

    {# Display any flash messages #}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('message') %}
        <div class="alert alert-success">{{ message }}</div>
    {% endfor %}

    {# Compact Search Form #}
    <div class="card shadow-sm mb-2">
        <div class="card-body p-2">
            <form method="get" action="{{ path('display_event') }}">
                <div class="row g-2">
                    <div class="col-md-3">
                        <input type="text" name="nom" class="form-control form-control-sm" placeholder="Nom" value="{{ app.request.query.get('nom') }}">
                    </div>
                    <div class="col-md-3">
                        <input type="date" name="date" class="form-control form-control-sm" value="{{ app.request.query.get('date') }}">
                    </div>
                    <div class="col-md-3">
                        <input type="text" name="adresse" class="form-control form-control-sm" placeholder="Adresse" value="{{ app.request.query.get('adresse') }}">
                    </div>
                    <div class="col-md-3 d-grid">
                        <button type="submit" class="btn btn-primary btn-sm">
                            <i class="bi bi-search"></i> Rechercher
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {# Compact Filter Form #}
    <div class="card shadow-sm mb-2">
        <div class="card-body p-2">
            <form method="get" action="{{ path('display_event') }}">
                <div class="row g-2">
                    <div class="col-md-4">
                        <select name="sort" class="form-select form-select-sm">
                            <option value="nom" {% if sortField == 'nom' %}selected{% endif %}>Nom</option>
                            <option value="date" {% if sortField == 'date' %}selected{% endif %}>Date</option>
                            <option value="nbr_places" {% if sortField == 'nbr_places' %}selected{% endif %}>Places</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select name="direction" class="form-select form-select-sm">
                            <option value="asc" {% if sortDirection == 'asc' %}selected{% endif %}>Ascendant</option>
                            <option value="desc" {% if sortDirection == 'desc' %}selected{% endif %}>Descendant</option>
                        </select>
                    </div>
                    <div class="col-md-4 d-grid">
                        <button type="submit" class="btn btn-secondary btn-sm">
                            <i class="bi bi-funnel"></i> Filtrer
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {# Events Table #}
    <table class="table table-striped table-hover shadow-sm">
        <thead class="table-dark">
            <tr>
                <th><a href="{{ path('display_event', {'sort': 'id', 'direction': sortDirection == 'asc' ? 'desc' : 'asc'}) }}" class="text-white">ID</a></th>
                <th><a href="{{ path('display_event', {'sort': 'nom', 'direction': sortDirection == 'asc' ? 'desc' : 'asc'}) }}" class="text-white">Nom</a></th>
                <th><a href="{{ path('display_event', {'sort': 'date', 'direction': sortDirection == 'asc' ? 'desc' : 'asc'}) }}" class="text-white">Date</a></th>
                <th>Adresse</th>
                <th>Description</th>
                <th>Image</th>
                <th><a href="{{ path('display_event', {'sort': 'nbr_places', 'direction': sortDirection == 'asc' ? 'desc' : 'asc'}) }}" class="text-white">Places</a></th>
                <th>Longitude</th>
                <th>Latitude</th>
                <th>Catégorie</th>
                <th style="width: 14%;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
                <tr>
                    <td>{{ event.id }}</td>
                    <td>{{ event.nom }}</td>
                    <td>
                        {% if event.date %}
                            {{ event.date|date('Y-m-d H:i') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ event.adresse }}</td>
                    <td>{{ event.description }}</td>
                    <td>
                        {% if event.image %}
                            <img src="{{ asset('uploads/images/' ~ event.image) }}"
                                 alt="{{ event.nom }}"
                                 class="img-thumbnail"
                                 style="width: 80px; height: auto;">
                        {% else %}
                            No image
                        {% endif %}
                    </td>
                    <td>{{ event.nbrPlaces }}</td>
                    <td>{{ event.longitude }}</td>
                    <td>{{ event.latitude }}</td>
                    <td>
                        {% if event.categorie %}
                            {{ event.categorie.nom }}
                        {% else %}
                            Aucune catégorie
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ path('edit_event', {'id': event.id}) }}" class="btn btn-warning btn-sm mb-1">Edit</a>
                        <a href="{{ path('Delete', {'id': event.id}) }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this event?')">Delete</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
