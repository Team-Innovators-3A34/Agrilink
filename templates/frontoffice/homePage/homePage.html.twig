{% extends "frontoffice/base.html.twig" %}{% block title %}Home{% endblock %} {%
  block content %}
  <div class="main-content right-chat-active">
    <div class="middle-sidebar-bottom">
      <div class="middle-sidebar-left">
        <!-- loader wrapper -->
        <div class="preloader-wrap p-3">
          <div class="box shimmer">
            <div class="lines">
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
            </div>
          </div>
          <div class="box shimmer mb-3">
            <div class="lines">
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
            </div>
          </div>
          <div class="box shimmer">
            <div class="lines">
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
              <div class="line s_shimmer"></div>
            </div>
          </div>
        </div>
        <!-- loader wrapper -->
        <div class="row feed-body">
          <div class="col-xl-8 col-xxl-9 col-lg-8">
            <div
              class="card w-100 shadow-xss rounded-xxl border-0 ps-4 pt-4 pe-4 pb-3 mb-3"
            >
              <div class="card-body p-0">
                <a
                  href="{{ path('app_posts_new') }}"
                  class="font-xssss fw-600 text-grey-500 card-body p-0 d-flex align-items-center"
                  ><i
                    class="btn-round-sm font-xs text-primary feather-edit-3 me-2 bg-greylight"
                  ></i
                  >Create Post</a
                >
              </div>
              <div class="card-body p-0 mt-3 position-relative">
                <figure class="avatar position-absolute ms-2 mt-1 top-5">
                  <img
                    src="images/user-8.png"
                    alt="image"
                    class="shadow-sm rounded-circle w30"
                  />
                </figure>
                <textarea
                  name="message"
                  class="h100 bor-0 w-100 rounded-xxl p-2 ps-5 font-xssss text-grey-500 fw-500 border-light-md theme-dark-bg"
                  cols="30"
                  rows="10"
                  placeholder="What's on your mind?"
                ></textarea>
              </div>
              <div class="card-body d-flex p-0 mt-0">
                <a
                  href="#"
                  class="d-flex align-items-center font-xssss fw-600 ls-1 text-grey-700 text-dark pe-4"
                  ><i class="font-md text-danger feather-video me-2"></i
                  ><span class="d-none-xs">Live Video</span></a
                >
                <a
                  href="#"
                  class="d-flex align-items-center font-xssss fw-600 ls-1 text-grey-700 text-dark pe-4"
                  ><i class="font-md text-success feather-image me-2"></i
                  ><span class="d-none-xs">Photo/Video</span></a
                >
                <a
                  href="#"
                  class="d-flex align-items-center font-xssss fw-600 ls-1 text-grey-700 text-dark pe-4"
                  ><i class="font-md text-warning feather-camera me-2"></i
                  ><span class="d-none-xs">Feeling/Activity</span></a
                >
                <a
                  href="#"
                  class="ms-auto"
                  id="dropdownMenu4"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  ><i
                    class="ti-more-alt text-grey-900 btn-round-md bg-greylight font-xss"
                  ></i
                ></a>
                <div
                  class="dropdown-menu dropdown-menu-start p-4 rounded-xxl border-0 shadow-lg"
                  aria-labelledby="dropdownMenu4"
                >
                  <div class="card-body p-0 d-flex">
                    <i class="feather-bookmark text-grey-500 me-3 font-lg"></i>
                    <h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
                      Save Link
                      <span
                        class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500"
                        >Add this to your saved items</span
                      >
                    </h4>
                  </div>
                  <div class="card-body p-0 d-flex mt-2">
                    <i
                      class="feather-alert-circle text-grey-500 me-3 font-lg"
                    ></i>
                    <h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
                      Hide Post
                      <span
                        class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500"
                        >Save to your saved items</span
                      >
                    </h4>
                  </div>
                  <div class="card-body p-0 d-flex mt-2">
                    <i
                      class="feather-alert-octagon text-grey-500 me-3 font-lg"
                    ></i>
                    <h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
                      Hide all from Group
                      <span
                        class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500"
                        >Save to your saved items</span
                      >
                    </h4>
                  </div>
                  <div class="card-body p-0 d-flex mt-2">
                    <i class="feather-lock text-grey-500 me-3 font-lg"></i>
                    <h4 class="fw-600 mb-0 text-grey-900 font-xssss mt-0 me-4">
                      Unfollow Group
                      <span
                        class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500"
                        >Save to your saved items</span
                      >
                    </h4>
                  </div>
                </div>
              </div>
            </div>
            {% for post in posts %}
            <div class="card w-100 shadow-xss rounded-xxl border-0 p-4 mb-3">
              <div class="card-body p-0 d-flex">
                <figure class="avatar me-3">
                  <img
                    src="{{ asset('uploads/images/' ~ post.getUserId().image) }}"
                    alt="image"
                    class="shadow-sm rounded-circle w45"
                    style="max-height: 50px; object-fit: cover"
                  />
                </figure>
                <a href="{{ path('app_profilee', { id: post.getUserId().id }) }}">
                <h4 class="fw-700 text-grey-900 font-xssss mt-1">
                  {{ post.getUserId().nom }} {{ post.getUserId().prenom }}
                  <span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500"
                    >{{ post.createdAt|date("d/m/Y") }}
                  </span>
                </h4>
              </a>
                <a
                  href="{{ path('app_post_detail', { id: post.id }) }}"
                  class="ms-auto"
                >
                  <i
                    class="ti-arrow-right text-grey-900 btn-round-md bg-greylight font-xss"
                  ></i>
                </a>
              </div>
              <div class="card-body p-0 me-lg-5">
                <p class="fw-500 text-grey-500 lh-26 font-xssss w-100">
                  {{ post.description }}
                </p>
              </div>
              {% if post.images | length > 1 %}
              <!-- Afficher plusieurs images -->
              <div class="card-body d-block p-0">
                <div class="row ps-2 pe-2">
                  {% for image in post.images %} {% if loop.index <= 3 %} {#
                  Limite l'affichage √† 3 images #}
                  <div class="col-xs-4 col-sm-4 p-1">
                    <a
                      href="{{ asset('uploads/images/' ~ image) }}"
                      data-lightbox="roadtrip"
                    >
                      <img
                        src="{{ asset('uploads/images/' ~ image) }}"
                        class="rounded-3 w-100"
                        alt="image"
                      />
                    </a>
                  </div>
                  {% endif %} {% endfor %} {% if post.images | length > 3 %}
                  <div class="col-xs-4 col-sm-4 p-1">
                    <a
                      href="{{ asset('uploads/images/' ~ post.images[3]) }}"
                      data-lightbox="roadtrip"
                      class="position-relative d-block"
                    >
                      <img
                        src="{{ asset('uploads/images/' ~ post.images[3]) }}"
                        class="rounded-3 w-100"
                        alt="image"
                      />
                      <span class="img-count font-sm text-white ls-3 fw-600">
                        <b>+{{ post.images | length - 3 }}</b>
                      </span>
                    </a>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% elseif post.images | length == 1 %}
              <!-- Afficher une seule image -->
              <div class="card-body d-block p-0 mb-3">
                <div class="row ps-2 pe-2">
                  <div class="col-sm-12 p-1">
                    <a
                      href="{{ asset('uploads/images/' ~ post.images[0]) }}"
                      data-lightbox="roadtr"
                    >
                      <img
                        src="{{ asset('uploads/images/' ~ post.images[0]) }}"
                        class="rounded-3 w-100"
                        alt="image"
                      />
                    </a>
                  </div>
                </div>
              </div>
              {% endif %}
  
           			<div class="card-body d-flex p-0 mt-3 position-relative">
  <a href="#" 
   class="emoji-bttn d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss me-2" 
   data-bs-toggle="modal" 
   data-bs-target="#reactionsModal-{{ post.id }}"
   onclick="return false;">
    <i class="feather-thumbs-up text-white bg-primary-gradiant me-1 btn-round-xs font-xss"></i>
    {{ post.reactions|length }}
    Reaction{{ post.reactions|length != 1 ? 's' : '' }}
</a>
    

<!-- Modal -->
<div class="modal fade" id="reactionsModal-{{ post.id }}" tabindex="-1" aria-labelledby="reactionsModalLabel-{{ post.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reactionsModalLabel-{{ post.id }}">Reactions to "{{ post.title }}"</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if post.reactions|length > 0 %}
                    {% for reaction in post.reactions %}
                    <div class="reaction p-3 mb-2 border-bottom">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <strong>
                                    {% if reaction.user.nom is defined and reaction.user.prenom is defined %}
                                        {{ reaction.user.nom }} {{ reaction.user.prenom }}
                                    {% else %}
                                        {{ reaction.user.username|default('User') }}
                                    {% endif %}
                                </strong>
                                {% if reaction.createdAt is defined %}
                                <small class="text-muted ms-2">{{ reaction.createdAt|date('Y-m-d H:i') }}</small>
                                {% endif %}
                            </div>
                            <div class="reaction-type">
                                {% if reaction.type == 'like' %}
                                    <i class="feather-thumbs-up text-primary"></i> Like
                                {% elseif reaction.type == 'bravo' %}
                                    <i class="feather-award text-success"></i> Bravo
                                {% elseif reaction.type == 'soutien' %}
                                    <i class="feather-heart text-danger"></i> Soutien
                                {% elseif reaction.type == 'instructif' %}
                                    <i class="feather-info text-info"></i> Instructif
                                {% elseif reaction.type == 'drole' %}
                                    <i class="bi bi-emoji-laughing text-warning"></i> Dr√¥le
                                {% else %}
                                    <i class="feather-thumbs-up text-primary"></i> Like
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="ri-chat-off-line fs-3 text-muted mb-2"></i>
                        <p>No reactions yet</p>
                    </div>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <a
      href="{{ path('app_post_detail', { id: post.id }) }}"
      class="d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss"
      ><i
        class="feather-message-circle text-dark text-grey-900 btn-round-sm font-lg"
      ></i
      >{{ post.comments | length }} Comment</a
    >
    
    <div class="dropdown">
        <a 
            href="#" 
            id="dropdownMenu21-{{ post.id }}" 
            data-bs-toggle="dropdown" 
            aria-expanded="false" 
            class="ms-auto d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss"
        >
            <i class="feather-share-2 text-grey-900 text-dark btn-round-sm font-lg"></i>
            <span class="d-none-xs">Share</span>
        </a>
        
        <div 
            class="dropdown-menu dropdown-menu-end p-4 rounded-xxl border-0 shadow-lg" 
            aria-labelledby="dropdownMenu21-{{ post.id }}"
        >
            <h4 class="fw-700 font-xss text-grey-900 d-flex align-items-center">
                Share
                <i class="feather-x ms-auto font-xssss btn-round-xs bg-greylight text-grey-900 me-2"></i>
            </h4>
            
            <div class="card-body p-0 d-flex">
                <ul class="d-flex align-items-center list-unstyled mb-0">
                    <li class="me-1">
                        <a 
                            href="https://www.facebook.com/sharer/sharer.php?u={{ url('app_post_detail', {'id': post.id})|url_encode }}" 
                            target="_blank" 
                            class="btn-round-lg bg-facebook"
                        >
                            <i class="font-xs ti-facebook text-white"></i>
                        </a>
                    </li>
                    <li class="me-1">
                        <a 
                            href="https://www.linkedin.com/sharing/share-offsite/?url={{ url('app_post_detail', {'id': post.id})|url_encode }}" 
                            target="_blank" 
                            class="btn-round-lg bg-linkedin"
                        >
                            <i class="font-xs ti-linkedin text-white"></i>
                        </a>
                    </li>
                    <li class="me-1">
                        <a 
                            href="https://api.whatsapp.com/send?text={{ post.title|url_encode ~ ' - ' ~ absolute_url(path('app_post_detail', {'id': post.id}))|url_encode }}" 
                            target="_blank" 
                            class="btn-round-lg bg-success"
                        >
                            <i class="font-xs feather-phone text-white"></i>
                        </a>
                    </li>
                    <li>
                        <a 
                            href="#" 
                            data-url="{{ absolute_url(path('app_post_detail', {'id': post.id})) }}" 
                            class="btn-round-lg bg-black"
                        >
                            <i class="font-xs ti-link text-white"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
</div>
            {% endfor %}

            
          </div>
          <div class="col-xl-4 col-xxl-3 col-lg-4 ps-lg-0" >
            <div class="card w-100 shadow-xss rounded-xxl border-0 mb-3"  >
              <div class="card-body d-flex align-items-center p-4">
                <h4 class="fw-700 mb-0 font-xssss text-grey-900">
                  Friend Request
                </h4>
                <a
                  href="default-member.html"
                  class="fw-600 ms-auto font-xssss text-primary"
                  >See all</a
                >
              </div>
  
              {% for friendship in getAllMyFriendRequests() %}
              <div
                class="card-body d-flex pt-4 ps-4 pe-4 pb-0 border-top-xs bor-0"
                
              >
                <figure class="avatar me-3">
                  <img
                    src="{{ asset('uploads/images/' ~ friendship.user.image) }}"
                    alt="image"
                    class="shadow-sm rounded-circle w45"
                    style="max-height: 50px;object-fit: cover"
                  />
                </figure>
                <h4 class="fw-700 text-grey-900 font-xssss mt-1">
                  {{ friendship.user.nom }} {{ friendship.user.prenom }}
                  <span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500"
                  >{{ friendship.user.email[:16] ~ '...' }}</span>
                  
                </h4>
              </div>
              <div
                class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4"
              >
                <a
                href="{{ path('app_accept_friend_request', { id: friendship.id }) }}" 
                class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl"
                  >Confirm</a
                >
                <a
                href="{{ path('app_unfriend', { id: friendship.id }) }}" 
                class="p-2 lh-20 w100 bg-grey text-grey-800 text-center font-xssss fw-600 ls-1 rounded-xl"
                  >Delete</a
                >
              </div>
              {% endfor %}
  
              {% if not getAllMyFriendRequests() %}
              <div class="card-body d-flex pt-4 ps-4 pe-4 pb-0 border-top-xs bor-0"style="margin-bottom: 30px;">
                <h4 class="fw-700 text-grey-900 font-xssss mt-1">
                  Pas de demandes d'amis
                </h4>
              </div>
              {% endif %}
  
             
  
              
            </div>
  
  
            <div class="card w-100 shadow-xss rounded-xxl border-0 mb-3"  >
              <div class="card-body d-flex align-items-center p-4">
                <h4 class="fw-700 mb-0 font-xssss text-grey-900">
                  M√©t√©o
                </h4>
               
              </div>
  
              <div class="card-body bg-transparent p-4 text-center" style="margin-top: -25px;margin-bottom:-20px;">
                {% if weather is defined %}
                <p class="mb-1 fs-5" id="temp">üå°Ô∏è <strong>Temp√©rature :</strong> {{ weather.main.temp }}¬∞C</p>
                <p class="mb-1 fs-5" id="wind">üå¨Ô∏è <strong>Vent :</strong> {{ weather.wind.speed }} km/h</p>
                <p class="mb-3 fs-5" id="desc">üå§Ô∏è <strong>Condition :</strong> {{ weather.weather[0].description }}</p>
            {% else %}
                <p class="text-muted">Aucune donn√©e m√©t√©o disponible.</p>
            {% endif %}
            
            <div class="input-group mb-3">
                <input type="text" class="form-control form-control-sm rounded-pill" id="city"  placeholder="Entrer une ville..">
                <button class="bg-current text-white rounded-circle d-flex align-items-center justify-content-center" 
        type="submit" 
        id="submit" 
        style="width: 40px; height: 40px; margin-top:7px; margin-left:8px">
    <i class="ti-location-arrow" style="transform: rotate(55deg);"></i>
</button>
           </div>
                
            </div>
              
  
            </div>
  
            <div class="card w-100 shadow-xss rounded-xxl border-0 p-0" >
              <div class="card-body d-flex align-items-center p-4 mb-0">
                <h4 class="fw-700 mb-0 font-xssss text-grey-900">
                  Sugg√©rer des amis 
                </h4>
              </div>
              {% for user in getMatchedUsers() %}
  
              <div
                class="card-body bg-transparent-card d-flex p-3 bg-greylight ms-3 me-3 rounded-3"
                style="margin-bottom: 7px;"
              >
                <figure class="avatar me-2 mb-0">
                  <img
                    src="{{ asset('uploads/images/' ~ user.image) }}"
                    alt="image"
                    class="shadow-sm rounded-circle w45"
                    style="max-height: 50px;object-fit: cover"
                  />
                </figure>
                <h4 class="fw-700 text-grey-900 font-xssss mt-2">
                   {{ user.nom }} {{ user.prenom }}
                  <span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500"
                    >{{ user.email[:16] ~ '...' }}</span>
                  
                </h4>
                <a
                  href="{{ path('app_profilee', { id: user.id }) }}"
                  class="btn-round-sm bg-white text-grey-900 feather-chevron-right font-xss ms-auto mt-2"
                ></a>
              </div>
              {% endfor %}
            
            </div>
  
            
  
            <div class="card w-100 shadow-xss rounded-xxl border-0 mb-3" style="margin-top: 17px;">
              <div class="card-body d-flex align-items-center p-4">
                <h4 class="fw-700 mb-0 font-xssss text-grey-900">Event</h4>
                <a
                  href="{{path("display_event_front")}}"
                  class="fw-600 ms-auto font-xssss text-primary"
                  >See all</a
                >
              </div>
  
              {% for event in events|shuffle|slice(0, 3) %}
              <div class="card-body d-flex pt-0 ps-4 pe-4 pb-3 overflow-hidden">
                <div class="bg-success me-2 p-3 rounded-xxl">
                  <h4 class="fw-700 font-lg ls-3 lh-1 text-white mb-0">
                    <span class="ls-1 d-block font-xsss text-white fw-600"
                      >{{ event.date|date('M') }}</span
                    >{{ event.date|date('d') }}
                  </h4>
                </div>
                <h4 class="fw-700 text-grey-900 font-xssss mt-2">
                  {{ event.nom }}
                  <span class="d-block font-xsssss fw-500 mt-1 lh-4 text-grey-500"
                    >{{ event.adresse }}</span
                  >
                </h4>
              </div>
              {% endfor %}
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Ajout de jQuery avant votre script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function(){
        $("#submit").on("click", function(){
            var city = $("#city").val().trim();
            if(city !== "") {
                fetchWeather(city);
            }
        });

        // Allow pressing 'Enter' to fetch weather
        $("#city").keypress(function(event) {
            if (event.which === 13) {  // 13 = Enter key
                $("#submit").click();
            }
        });
    });

    function fetchWeather(city) {
        $.ajax({
            url: "/get-weather",  // Update with your actual route
            type: "POST",
            data: JSON.stringify({ city: city }),
            contentType: "application/json",
            success: function(response) {
                updateWeatherUI(response);
            },
            error: function() {
                alert("Erreur lors de la r√©cup√©ration des donn√©es m√©t√©o.");
            }
        });
    }

    function updateWeatherUI(data) {
        if (!data || !data.temperature) {
            alert("Donn√©es m√©t√©o non disponibles.");
            return;
        }

        $("#temp").html("üå°Ô∏è <strong>Temp√©rature :</strong> " + data.temperature + "¬∞C");
        $("#wind").html("üå¨Ô∏è <strong>Vent :</strong> " + data.wind + " km/h");
        $("#desc").html("üå§Ô∏è <strong>Condition :</strong> " + data.description);
    }
</script>

  {% endblock %}
  