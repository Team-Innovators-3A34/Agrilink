{% extends "frontoffice/base.html.twig" %}
{% block title %}Home
{% endblock %}
{%
block content %}
	<div class="main-content right-chat-active">
		<div class="middle-sidebar-bottom">
			<div
				class="middle-sidebar-left">
				<!-- loader wrapper -->
				<div class="preloader-wrap p-3">
					<div class="box shimmer">
						<div class="lines">
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
						</div>
					</div>
					<div class="box shimmer mb-3">
						<div class="lines">
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
						</div>
					</div>
					<div class="box shimmer">
						<div class="lines">
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
							<div class="line s_shimmer"></div>
						</div>
					</div>
				</div>
				<!-- loader wrapper -->
				<div class="row feed-body">
					<div class="col-xl-8 col-xxl-9 col-lg-8">
						<div class="card w-100 shadow-xss rounded-xxl border-0 ps-4 pt-4 pe-4 pb-3 mb-3">
							<div class="card-body p-0">
								<a href="{{ path('app_posts_new') }}" class="font-xssss fw-600 text-grey-500 card-body p-0 d-flex align-items-center">
									<i class="btn-round-sm font-xs text-primary feather-edit-3 me-2 bg-greylight"></i>Create Post</a>
							</div>
							<div class="card-body p-0 mt-3 position-relative">
								<figure class="avatar position-absolute ms-2 mt-1 top-5">
									<img src="images/user-8.png" alt="image" class="shadow-sm rounded-circle w30"/>
								</figure>
								<textarea name="message" class="h100 bor-0 w-100 rounded-xxl p-2 ps-5 font-xssss text-grey-500 fw-500 border-light-md theme-dark-bg" cols="30" rows="10" placeholder="What's on your mind?"></textarea>
							</div>
							<div class="card-body d-flex p-0 mt-0">
								<a href="#" class="d-flex align-items-center font-xssss fw-600 ls-1 text-grey-700 text-dark pe-4">
									<i class="font-md text-danger feather-video me-2"></i>
									<span class="d-none-xs">Live Video</span>
								</a>
								<a href="#" class="d-flex align-items-center font-xssss fw-600 ls-1 text-grey-700 text-dark pe-4">
									<i class="font-md text-success feather-image me-2"></i>
									<span class="d-none-xs">Photo/Video</span>
								</a>
								<a href="#" class="d-flex align-items-center font-xssss fw-600 ls-1 text-grey-700 text-dark pe-4">
									<i class="font-md text-warning feather-camera me-2"></i>
									<span class="d-none-xs">Feeling/Activity</span>
								</a>
								<a href="#" class="ms-auto" id="dropdownMenu4" data-bs-toggle="dropdown" aria-expanded="false">
									<i class="ti-more-alt text-grey-900 btn-round-md bg-greylight font-xss"></i>
								</a>
								<div class="dropdown-menu dropdown-menu-start p-4 rounded-xxl border-0 shadow-lg" aria-labelledby="dropdownMenu4">
									<div class="card-body p-0 d-flex">
										<i class="feather-bookmark text-grey-500 me-3 font-lg"></i>
										<h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
											Save Link
											<span class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500">Add this to your saved items</span>
										</h4>
									</div>
									<div class="card-body p-0 d-flex mt-2">
										<i class="feather-alert-circle text-grey-500 me-3 font-lg"></i>
										<h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
											Hide Post
											<span class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500">Save to your saved items</span>
										</h4>
									</div>
									<div class="card-body p-0 d-flex mt-2">
										<i class="feather-alert-octagon text-grey-500 me-3 font-lg"></i>
										<h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
											Hide all from Group
											<span class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500">Save to your saved items</span>
										</h4>
									</div>
									<div class="card-body p-0 d-flex mt-2">
										<i class="feather-lock text-grey-500 me-3 font-lg"></i>
										<h4 class="fw-600 mb-0 text-grey-900 font-xssss mt-0 me-4">
											Unfollow Group
											<span class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500">Save to your saved items</span>
										</h4>
									</div>
								</div>
							</div>
						</div>
						{% for post in posts %}
							<div class="card w-100 shadow-xss rounded-xxl border-0 p-4 mb-3">
								<div class="card-body p-0 d-flex">
									<figure class="avatar me-3">
										<img src="{{ asset('uploads/images/' ~ post.getUserId().image) }}" alt="image" class="shadow-sm rounded-circle w45" style="max-height: 50px; object-fit: cover"/>
									</figure>
									<h4 class="fw-700 text-grey-900 font-xssss mt-1">
										{{ post.getUserId().nom }}
										{{ post.getUserId().prenom }}
										<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">{{ post.createdAt|date("d/m/Y") }}
										</span>
									</h4>
									<a href="{{ path('app_post_detail', { id: post.id }) }}" class="ms-auto">
										<i class="ti-arrow-right text-grey-900 btn-round-md bg-greylight font-xss"></i>
									</a>
								</div>
								<div class="card-body p-0 me-lg-5">
									<p class="fw-500 text-grey-500 lh-26 font-xssss w-100">
										{{ post.description }}
									</p>
								</div>
								{% if post.images | length > 1 %}
									<!-- Afficher plusieurs images -->
									<div class="card-body d-block p-0">
										<div class="row ps-2 pe-2">
											{% for image in post.images %}
												{% if loop.index <= 3 %}
													{#
																										                Limite l'affichage à 3 images #}
													<div class="col-xs-4 col-sm-4 p-1">
														<a href="{{ asset('uploads/images/' ~ image) }}" data-lightbox="roadtrip">
															<img src="{{ asset('uploads/images/' ~ image) }}" class="rounded-3 w-100" alt="image"/>
														</a>
													</div>
												{% endif %}
											{% endfor %}
											{% if post.images | length > 3 %}
												<div class="col-xs-4 col-sm-4 p-1">
													<a href="{{ asset('uploads/images/' ~ post.images[3]) }}" data-lightbox="roadtrip" class="position-relative d-block">
														<img src="{{ asset('uploads/images/' ~ post.images[3]) }}" class="rounded-3 w-100" alt="image"/>
														<span class="img-count font-sm text-white ls-3 fw-600">
															<b>+{{ post.images | length - 3 }}</b>
														</span>
													</a>
												</div>
											{% endif %}
										</div>
									</div>
								{% elseif post.images | length == 1 %}
									<!-- Afficher une seule image -->
									<div class="card-body d-block p-0 mb-3">
										<div class="row ps-2 pe-2">
											<div class="col-sm-12 p-1">
												<a href="{{ asset('uploads/images/' ~ post.images[0]) }}" data-lightbox="roadtr">
													<img src="{{ asset('uploads/images/' ~ post.images[0]) }}" class="rounded-3 w-100" alt="image"/>
												</a>
											</div>
										</div>
									</div>
								{% endif %}

								{# <div class="card-body d-flex p-0 mt-3">
																	  <a href="#" class="emoji-bttn d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss me-2">
								        <i class="feather-thumbs-up text-white bg-primary-gradiant me-1 btn-round-xs font-xss"></i>
								        {{ post.reactions|length }} Reaction{{ post.reactions|length != 1 ? 's' : '' }}
								    </a>
																
															
																<div class="emoji-wrap">
																	<ul class="emojis list-inline mb-0">
																		<li class="emoji list-inline-item">
																			<i class="em em---1"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-angry"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-anguished"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-astonished"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-blush"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-clap"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-cry"></i>
																		</li>
																		<li class="emoji list-inline-item">
																			<i class="em em-full_moon_with_face"></i>
																		</li>
																	</ul>
																</div> #}
								<div class="card-body d-flex p-0 mt-3 position-relative">
    <a href="#" class="emoji-bttn d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss me-2" onclick="toggleCustomPopup('reactions-popup-{{ post.id }}'); return false;">
        <i class="feather-thumbs-up text-white bg-primary-gradiant me-1 btn-round-xs font-xss"></i>
        {{ post.reactions|length }}
        Reaction{{ post.reactions|length != 1 ? 's' : '' }}
    </a>
    
    <div id="reactions-popup-{{ post.id }}" class="custom-popup card shadow" style="display: none; position: absolute; z-index: 999; width: 300px; max-height: 400px; overflow-y: auto; background: white; border-radius: 8px; top: 100%; left: 0;">
        <div class="card-header d-flex justify-content-between align-items-center bg-light">
            <h6 class="mb-0">Reactions ({{ post.reactions|length }})</h6>
            <button type="button" class="btn-close" onclick="toggleCustomPopup('reactions-popup-{{ post.id }}')"></button>
        </div>
        <div class="card-body p-0">
            <ul class="list-group list-group-flush">
                {% for reaction in post.reactions %}
                    <li class="list-group-item d-flex align-items-center">
                        <div class="reaction-icon me-2">
                            {% if reaction.type == 'like' %}
                                <i class="feather-thumbs-up text-white bg-primary-gradiant btn-round-xs font-xss p-1"></i>
                            {% elseif reaction.type == 'bravo' %}
                                <i class="feather-award text-white bg-primary-gradiant btn-round-xs font-xss p-1"></i>
                            {% elseif reaction.type == 'soutien' %}
                                <i class="feather-heart text-white bg-primary-gradiant btn-round-xs font-xss p-1"></i>
                            {% elseif reaction.type == 'instructif' %}
                                <i class="feather-info text-white bg-primary-gradiant btn-round-xs font-xss p-1"></i>
                            {% elseif reaction.type == 'drole' %}
                                <i class="bi bi-emoji-laughing text-white bg-primary-gradiant btn-round-xs font-xss p-1"></i>
                            {% else %}
                                <i class="feather-thumbs-up text-white bg-primary-gradiant btn-round-xs font-xss p-1"></i>
                            {% endif %}
                        </div>
                        <span class="reaction-type fw-bold me-2">
                            {% if reaction.type == 'like' %}Like
                            {% elseif reaction.type == 'bravo' %}Bravo
                            {% elseif reaction.type == 'soutien' %}Soutien
                            {% elseif reaction.type == 'instructif' %}Instructif
                            {% elseif reaction.type == 'drole' %}Drôle
                            {% else %}Like
                            {% endif %}
                        </span>
                        <span class="fw-500">{{ reaction.user.nom }}</span>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
<script>
function toggleCustomPopup(id) {
    const popup = document.getElementById(id);
    if (popup.style.display === 'none') {
        popup.style.display = 'block';
        
        // Check if popup is going off-screen and adjust if needed
        setTimeout(() => {
            const rect = popup.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                popup.style.left = 'auto';
                popup.style.right = '0';
            }
            
            if (rect.bottom > window.innerHeight) {
                popup.style.top = 'auto';
                popup.style.bottom = '100%';
            }
        }, 0);
    } else {
        popup.style.display = 'none';
    }
}

// Close popup when clicking outside
document.addEventListener('click', function(event) {
    const popups = document.querySelectorAll('.custom-popup');
    popups.forEach(function(popup) {
        if (popup.style.display === 'block' && 
            !popup.contains(event.target) && 
            !event.target.closest('a[onclick*="toggleCustomPopup"]')) {
            popup.style.display = 'none';
        }
    });
});
</script>
								<a href="{{ path('app_post_detail', { id: post.id }) }}" class="d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss">
									<i class="feather-message-circle text-dark text-grey-900 btn-round-sm font-lg"></i>
									{{ post.comments | length }}
									Comment</a>
								<a href="#" id="dropdownMenu21" data-bs-toggle="dropdown" aria-expanded="false" class="ms-auto d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss">
									<i class="feather-share-2 text-grey-900 text-dark btn-round-sm font-lg"></i>
									<span class="d-none-xs">Share</span>
								</a>
								<div class="dropdown-menu dropdown-menu-end p-4 rounded-xxl border-0 shadow-lg" aria-labelledby="dropdownMenu21">
									<h4 class="fw-700 font-xss text-grey-900 d-flex align-items-center">
										Share
										<i class="feather-x ms-auto font-xssss btn-round-xs bg-greylight text-grey-900 me-2"></i>
									</h4>
									<div class="card-body p-0 d-flex">
										<ul class="d-flex align-items-center justify-content-between mt-2">
											<li class="me-1">
												<a href="https://www.facebook.com/sharer/sharer.php?u={{ url('app_post_detail', {'id': post.id})|url_encode }}" target="_blank" class="btn-round-lg bg-facebook">
													<i class="font-xs ti-facebook text-white"></i>
												</a>
											</li>
											<li class="me-1">
												<a href="https://www.linkedin.com/sharing/share-offsite/?url={{ url('app_post_detail', {'id': post.id})|url_encode }}" target="_blank" class="btn-round-lg bg-linkedin" class="btn-round-lg bg-linkedin">
													<i class="font-xs ti-linkedin text-white"></i>
												</a>
											</li>
											<li>
												<a href="https://api.whatsapp.com/send?text={{ post.title|url_encode ~ ' - ' ~ absolute_url(path('app_post_detail', {'id': post.id}))|url_encode }}" target="_blank" class="btn-round-lg bg-success">
													<i class="font-xs feather-phone text-white"></i>
												</a>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					{% endfor %}
				</div>
				<div class="col-xl-4 col-xxl-3 col-lg-4 ps-lg-0">
					<div class="card w-100 shadow-xss rounded-xxl border-0 mb-3">
						<div class="card-body d-flex align-items-center p-4">
							<h4 class="fw-700 mb-0 font-xssss text-grey-900">
								Friend Request
							</h4>
							<a href="default-member.html" class="fw-600 ms-auto font-xssss text-primary">See all</a>
						</div>
						<div class="card-body d-flex pt-4 ps-4 pe-4 pb-0 border-top-xs bor-0">
							<figure class="avatar me-3">
								<img src="images/user-7.png" alt="image" class="shadow-sm rounded-circle w45"/>
							</figure>
							<h4 class="fw-700 text-grey-900 font-xssss mt-1">
								Anthony Daugloi
								<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">12 mutual friends</span>
							</h4>
						</div>
						<div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
							<a href="#" class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl">Confirm</a>
							<a href="#" class="p-2 lh-20 w100 bg-grey text-grey-800 text-center font-xssss fw-600 ls-1 rounded-xl">Delete</a>
						</div>

						<div class="card-body d-flex pt-0 ps-4 pe-4 pb-0">
							<figure class="avatar me-3">
								<img src="images/user-8.png" alt="image" class="shadow-sm rounded-circle w45"/>
							</figure>
							<h4 class="fw-700 text-grey-900 font-xssss mt-1">
								Mohannad Zitoun
								<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">12 mutual friends</span>
							</h4>
						</div>
						<div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
							<a href="#" class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl">Confirm</a>
							<a href="#" class="p-2 lh-20 w100 bg-grey text-grey-800 text-center font-xssss fw-600 ls-1 rounded-xl">Delete</a>
						</div>

						<div class="card-body d-flex pt-0 ps-4 pe-4 pb-0">
							<figure class="avatar me-3">
								<img src="images/user-12.png" alt="image" class="shadow-sm rounded-circle w45"/>
							</figure>
							<h4 class="fw-700 text-grey-900 font-xssss mt-1">
								Mohannad Zitoun
								<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">12 mutual friends</span>
							</h4>
						</div>
						<div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
							<a href="#" class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl">Confirm</a>
							<a href="#" class="p-2 lh-20 w100 bg-grey text-grey-800 text-center font-xssss fw-600 ls-1 rounded-xl">Delete</a>
						</div>
					</div>

					<div class="card w-100 shadow-xss rounded-xxl border-0 p-0">
						<div class="card-body d-flex align-items-center p-4 mb-0">
							<h4 class="fw-700 mb-0 font-xssss text-grey-900">
								Confirm Friend
							</h4>
							<a href="default-member.html" class="fw-600 ms-auto font-xssss text-primary">See all</a>
						</div>
						<div class="card-body bg-transparent-card d-flex p-3 bg-greylight ms-3 me-3 rounded-3">
							<figure class="avatar me-2 mb-0">
								<img src="images/user-7.png" alt="image" class="shadow-sm rounded-circle w45"/>
							</figure>
							<h4 class="fw-700 text-grey-900 font-xssss mt-2">
								Anthony Daugloi
								<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">12 mutual friends</span>
							</h4>
							<a href="#" class="btn-round-sm bg-white text-grey-900 feather-chevron-right font-xss ms-auto mt-2"></a>
						</div>
						<div class="card-body bg-transparent-card d-flex p-3 bg-greylight m-3 rounded-3" style="margin-bottom: 0 !important">
							<figure class="avatar me-2 mb-0">
								<img src="images/user-8.png" alt="image" class="shadow-sm rounded-circle w45"/>
							</figure>
							<h4 class="fw-700 text-grey-900 font-xssss mt-2">
								David Agfree
								<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">12 mutual friends</span>
							</h4>
							<a href="#" class="btn-round-sm bg-white text-grey-900 feather-plus font-xss ms-auto mt-2"></a>
						</div>
						<div class="card-body bg-transparent-card d-flex p-3 bg-greylight m-3 rounded-3">
							<figure class="avatar me-2 mb-0">
								<img src="images/user-12.png" alt="image" class="shadow-sm rounded-circle w45"/>
							</figure>
							<h4 class="fw-700 text-grey-900 font-xssss mt-2">
								Hugury Daugloi
								<span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">12 mutual friends</span>
							</h4>
							<a href="#" class="btn-round-sm bg-white text-grey-900 feather-plus font-xss ms-auto mt-2"></a>
						</div>
					</div>

					<div class="card w-100 shadow-xss rounded-xxl border-0 mb-3 mt-3">
						<div class="card-body d-flex align-items-center p-4">
							<h4 class="fw-700 mb-0 font-xssss text-grey-900">
								Suggest Group
							</h4>
							<a href="default-group.html" class="fw-600 ms-auto font-xssss text-primary">See all</a>
						</div>
						<div class="card-body d-flex pt-4 ps-4 pe-4 pb-0 overflow-hidden border-top-xs bor-0">
							<img src="images/e-2.jpg" alt="img" class="img-fluid rounded-xxl mb-2"/>
						</div>
						<div class="card-body dd-block pt-0 ps-4 pe-4 pb-4">
							<ul class="memberlist mt-1 mb-2 ms-0 d-block">
								<li class="w20">
									<a href="#"><img src="images/user-6.png" alt="user" class="w35 d-inline-block" style="opacity: 1"/></a>
								</li>
								<li class="w20">
									<a href="#"><img src="images/user-7.png" alt="user" class="w35 d-inline-block" style="opacity: 1"/></a>
								</li>
								<li class="w20">
									<a href="#"><img src="images/user-8.png" alt="user" class="w35 d-inline-block" style="opacity: 1"/></a>
								</li>
								<li class="w20">
									<a href="#"><img src="images/user-3.png" alt="user" class="w35 d-inline-block" style="opacity: 1"/></a>
								</li>
								<li class="last-member">
									<a href="#" class="bg-greylight fw-600 text-grey-500 font-xssss w35 ls-3 text-center" style="height: 35px; line-height: 35px">+2</a>
								</li>
								<li class="ps-3 w-auto ms-1">
									<a href="#" class="fw-600 text-grey-500 font-xssss">Member apply</a>
								</li>
							</ul>
						</div>
					</div>

					<div class="card w-100 shadow-xss rounded-xxl border-0 mb-3">
						<div class="card-body d-flex align-items-center p-4">
							<h4 class="fw-700 mb-0 font-xssss text-grey-900">
								Suggest Pages
							</h4>
							<a href="default-group.html" class="fw-600 ms-auto font-xssss text-primary">See all</a>
						</div>
						<div class="card-body d-flex pt-4 ps-4 pe-4 pb-0 overflow-hidden border-top-xs bor-0">
							<img src="images/g-2.jpg" alt="img" class="img-fluid rounded-xxl mb-2"/>
						</div>
						<div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
							<a href="#" class="p-2 lh-28 w-100 bg-grey text-grey-800 text-center font-xssss fw-700 rounded-xl">
								<i class="feather-external-link font-xss me-2"></i>
								Like
																                Page</a>
						</div>

						<div class="card-body d-flex pt-0 ps-4 pe-4 pb-0 overflow-hidden">
							<img src="images/g-3.jpg" alt="img" class="img-fluid rounded-xxl mb-2 bg-lightblue"/>
						</div>
						<div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
							<a href="#" class="p-2 lh-28 w-100 bg-grey text-grey-800 text-center font-xssss fw-700 rounded-xl">
								<i class="feather-external-link font-xss me-2"></i>
								Like
																                Page</a>
						</div>
					</div>

					<div class="card w-100 shadow-xss rounded-xxl border-0 mb-3">
						<div class="card-body d-flex align-items-center p-4">
							<h4 class="fw-700 mb-0 font-xssss text-grey-900">Event</h4>
							<a href="{{path("display_event_front")}}" class="fw-600 ms-auto font-xssss text-primary">See all</a>
						</div>

						{% for event in events|shuffle|slice(0, 3) %}
							<div class="card-body d-flex pt-0 ps-4 pe-4 pb-3 overflow-hidden">
								<div class="bg-success me-2 p-3 rounded-xxl">
									<h4 class="fw-700 font-lg ls-3 lh-1 text-white mb-0">
										<span class="ls-1 d-block font-xsss text-white fw-600">{{ event.date|date('M') }}</span>
										{{ event.date|date('d') }}
									</h4>
								</div>
								<h4 class="fw-700 text-grey-900 font-xssss mt-2">
									{{ event.nom }}
									<span class="d-block font-xsssss fw-500 mt-1 lh-4 text-grey-500">{{ event.adresse }}</span>
								</h4>
							</div>
						{% endfor %}

					</div>
				</div>
			</div>
		</div>
	</div>
</div>{% endblock %}
